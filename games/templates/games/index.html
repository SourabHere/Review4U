{% extends 'games/basic.html'%}
{% block title %} Home {% endblock %}
{%block body%}
<style>
    .series {
        /* background-color: black; */
        display: flex;
        justify-content: center;
        align-items: center;
        /* text-align: center; */
        width: 85%;
        margin: auto;
    }

    .card {
        /* margin-right:5% ; */
        display: block;
        margin-top: 2%;
        /* max-height: 40%; */
        align-items: center;
        text-align: center;
        width: 38rem;
        height: auto;
    }

    .card-body {
        text-align: left;
    }

    .components {
        /* margin-top: 50px; */
        display: flex;
        flex-wrap: wrap;
        /* justify-content: center; */
        justify-content: space-between;
        align-items: center;
    }

    .imgs {
        margin-top: 1rem;
        height: 20rem;
        max-width: 35rem;
    }

    .head {
        text-align: center;
    }

    .container {
        /* display: flex; */
        text-align: center;
    }

    .more {
        text-decoration: none;
        color: black;
    }

    .more:hover {
        color: rgb(43, 41, 41);
        border-bottom: 2px solid rgb(43, 41, 41);
    }

    .linkimg:hover {
        opacity: 0.9;
    }
    .cardrecc {
        width: 100%;
        /* height: 4rem; */
    }
    .poptitle{
        font-size: 0.7rem;
        margin: 0;
    }
    .popcbody{
        align-items: center;
        text-align: left;
        padding: 0;
        padding-left: 5%;
    }
    .poparea{
        height: 3.5rem;
        align-items: center;
    }
    .popimage{
        height:3.5rem;
        max-width:5rem;
        /* max-width: 100%; */
    }
    .popimgarea{
        text-align: start;
        background-size: cover;
        width: auto;
        /* width: fit-content; */
    }
    .popover{
        width: 20rem;
    }
    .more2{
        text-decoration: none;
        color: black;
    }
    .more2:hover {
        color: rgb(43, 41, 41);
        border-bottom: 2px solid rgb(43, 41, 41);
    }
    @media(max-width:1460px) {
        .series {
            /* background-color: black; */
            width: 80%;
        }

        .imgs {
            height: 20rem;
            max-width: 38rem;
        }

        .components {
            justify-content: center;
        }
    }

    @media(max-width:800px) {
        .series {
            width: 65%;
        }

        .imgs {
            height: 15rem;
            max-width: 22rem;
        }

        .card {
            width: 25rem;
        }
    }

    @media(max-width:450px) {
        .card {
            width: 15rem;
        }

        .imgs {
            height: 7.1rem;
            max-width: 14rem;
        }
    }

    @media(max-width:250px) {
        .card {
            width: 8rem;
        }

        .imgs {
            margin-top: 0.5rem;
            height: 4rem;
            max-width: 8rem;
        }
    }

    @media(min-width:1650px) {
        .card {
            margin-left: 0.7rem;
            margin-right: 0.7rem;
        }
    }
</style>
{%load static%}

<div class="container my-4">
    <h2>Games</h2>
</div>
<div class="series  my-1">
    <div class="components">
        {% for i in glist%}

        <div class="card mx-1 G{{forloop.counter0}}" id="card{{i.games_id}}}">
            <a href="/games/moredetail/{{i.games_id}}" class="linkimg" id="detail{{forloop.counter0}}"> <img src='/media/{{i.game_img}}'
                    class="img-fluid imgs mx-1" alt="..." id="Game{{forloop.counter0}}"></a>
            <div class="card-body mx-1">
                <h3 class="card-title head" id="name{{i.games_id}}"> <a href="/games/moredetail/{{i.games_id}}"
                        class="more">{{i.game_name}}</a></h3>
                <p class="card-text" id="desc{{i.games_id}}">{{i.desc|slice:"0:183"}}...</p>
                <p id="rate{{i.games_id}}">{{i.rating}}/10<i class="bi bi-star-fill">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="orange"
                            class="bi bi-star-fill" viewBox="0 1 16 16">
                            <path
                                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                        </svg>
                    </i>({{i.noOfRev}})</p>
                <a href="/games/myrev/{{i.games_id}}" class="btn btn-primary" id="rev{{i.games_id}}"
                    style="background-color: #0d9f0d; border:2px #0d9f0d;">Add my review</a>
            </div>
        </div>

        {%endfor%}
    </div>
</div>


{%endblock%}

{%block script%}
<script>
    //popover
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl)

    });

    let search = document.getElementById('search1');
    let searchbtn = document.getElementById('searchbtn');


    //updatePopover

    function updatePopover() {
        console.log("we are here");

        var popstr = "";
        let count = 0
        more = document.getElementsByClassName('more');
        Array.from(more).forEach(element => {
            let Gname = element.textContent;

            curclass = document.querySelector(`.G${count}`);
            originnalname = Gname;
            Gname = Gname.toLowerCase();
            // searchval = searchval.toLowerCase();
            // searchsize = searchval.length;

            Gameimg = document.getElementById(`Game${count}`);

            detail=document.getElementById(`detail${count}`);

            // console.log("yahooo");
            // console.log(Aname);

            popstr = popstr + `<div class="card mb-3 cardrecc box${count}" style="width:auto;">
                <div class="row g-0 content${count} poparea">
                    <div class="col-md-4 popimgarea">
                        <a href="${detail.getAttribute("href")}" class="linkimg"><img src="${Gameimg.getAttribute("src")}" class="img-fluid rounded-start popimage" alt="..."></a>
                        </div>
                        <div class="col-md-8">
                            <div class="card-body popcbody" >
                                <a href="${detail.getAttribute("href")}" class="more2"><h5 class="card-title card${count} poptitle" >${originnalname}</h5></a>
                                </div>
                                </div>
                                </div>
                                </div>`;
            search.setAttribute('data-bs-content', popstr);

            count++;
        });
        // console.log(popstr);

        search.setAttribute('data-bs-content', popstr);
        // $('#search1').popover('show');
    }



    // let search = document.getElementById('search1');
    // let searchbtn = document.getElementById('searchbtn');

    search.addEventListener("input", function () {
        // let searchval = search.value;
        // console.log(searchval);
        let searchval = search.value.toLowerCase();
        // console.log(searchval);

        updatePopover(searchval);


        if (searchval == '') {
            // console.log("here");
            $('#search1').popover('hide');

        }
        else {
            // console.log("not here");
            $('#search1').popover('show');
        }

        let searchpop = document.getElementsByClassName("cardrecc");
        // console.log(searchpop.textContent);

        let count = 0;
        Array.from(searchpop).forEach(element => {
            // console.log(element.textContent);

            let cardn = document.querySelector(`.card${count}`);
            let box = document.querySelector(`.box${count}`);

            let Gamehere = cardn.textContent;
            Gamehere = Gamehere.toLowerCase();

            // console.log(Animehere);
            // console.log(count);

            if (Gamehere == searchval || Gamehere.slice(0, searchval.length) == searchval) {
                box.style.display = "";
            }
            else {
                box.style.display = "none";
            }

            count++;
        })

    });

    searchbtn.addEventListener("click", function (event) {
        event.preventDefault();
        let finalinp = search.value;
        // console.log(finalinp);

        let count = 0;
        more = document.getElementsByClassName('more');
        Array.from(more).forEach(element => {
            let Gname = element.textContent;

            curclass = document.querySelector(`.G${count}`);
            // console.log(curclass);

            Gname = Gname.toLowerCase();
            finalinp = finalinp.toLowerCase();
            finalinpsize = finalinp.length;


            if (Gname == finalinp || Gname.slice(0, finalinpsize) == finalinp) {
                // console.log("yahooo");
                curclass.style.display = "";
            }
            // else if (Gname != finalinp) {
            //     console.log((Gname.slice(0, 2)));
            //     if ((Gname.slice(0, 2)).includes(finalinp)) {
            //         curclass.style.display = "";
            //     }
            //     else {
            //         curclass.style.display = "none";
            //     }
            // }
            else if((Gname.includes(finalinp))&&(finalinp.length>4)){
                curclass.style.display="";
            }
            else {
                // console.log("nopes");
                curclass.style.display = "none";
            }
            count++;
        });

    });
</script>
{%endblock%}